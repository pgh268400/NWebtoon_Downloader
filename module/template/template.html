<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{title}}</title>
    <style>
      /* 뷰어 */
      .webtoon_viewer {
        height: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }

      /* 리모콘 */
      #remote {
        width: 200px;
        height: 200px;
        position: absolute;
        z-index: 9;
        background-color: #f1f1f1;
        border: 1px solid #d3d3d3;
        text-align: center;
        right: 20px;
        top: 50%;
        transform: translateY(-50%);
      }

      #remote_header {
        padding: 10px;
        cursor: move;
        z-index: 10;
        background-color: #2196f3;
        color: #fff;
      }
    </style>
  </head>
  <body>
    <!-- 네이버 웹툰 사이트에 존재하던 리모콘 -->
    <!-- Draggable DIV -->
    <div id="remote">
      <!-- Include a header DIV with the same name as the draggable DIV, followed by "header" -->
      <div id="remote_header">리모콘</div>
      <p>{{title}}</p>
      <p>{{episode}}</p>
      <a href="{{prev}}">이전화</a>
      <a href="{{next}}">다음화</a>
    </div>

    <!-- 태그를 화면 정중앙에 위치 -->
    <div class="webtoon_viewer">
      <!-- Use jinja2 formatting -->
      <h1>{{title}}</h1>
      <h2>{{episode}}</h2>
      <!-- 끝에 "-" 는 반복하면서 newline 을 출력하지 않겠다고 명시하는 것. 그냥 끝을 %로 써도 됨. -->
      {% for item in img_lst -%}
      <img src="{{item}}" />
      {% endfor -%}
      <div>
        <a href="{{prev}}">이전화</a>
        <a href="{{next}}">다음화</a>
      </div>
    </div>
    <script>
      // Make the DIV element draggable:
      set_drag_element(document.getElementById("remote"));

      function set_drag_element(draggable_element) {
        let delta_x = 0;
        let delta_y = 0;
        let start_x = 0;
        let start_y = 0;
        const header_element = document.getElementById(
          `${draggable_element.id}_header`
        );
        const drag_start_target = header_element ?? draggable_element;

        drag_start_target.onmousedown = start_drag;

        function start_drag(event) {
          const mouse_event = event || window.event;
          mouse_event.preventDefault();
          start_x = mouse_event.clientX;
          start_y = mouse_event.clientY;
          document.onmouseup = stop_drag;
          document.onmousemove = handle_drag;
        }

        function handle_drag(event) {
          const mouse_event = event || window.event;
          mouse_event.preventDefault();
          delta_x = start_x - mouse_event.clientX;
          delta_y = start_y - mouse_event.clientY;
          start_x = mouse_event.clientX;
          start_y = mouse_event.clientY;
          draggable_element.style.top = `${
            draggable_element.offsetTop - delta_y
          }px`;
          draggable_element.style.left = `${
            draggable_element.offsetLeft - delta_x
          }px`;
        }

        function stop_drag() {
          document.onmouseup = null;
          document.onmousemove = null;
        }
      }
    </script>
  </body>
</html>
